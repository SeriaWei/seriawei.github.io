(function(n){"use strict";typeof define=="function"&&define.amd?define("jstree.contextmenu",["jquery","jstree"],n):typeof exports=="object"?n(require("jquery"),require("jstree")):n(jQuery,jQuery.jstree)})(function(n,t,i){"use strict";n.jstree.plugins.contextmenu||(n.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(n){setTimeout(function(){i.edit(n)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!n.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},n.jstree.plugins.contextmenu=function(t,r){this.bind=function(){r.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",n.proxy(function(n){n.preventDefault();t=n.ctrlKey?n.timeStamp:0;this.is_loading(n.currentTarget)||this.show_contextmenu(n.currentTarget,n.pageX,n.pageY,n)},this)).on("click.jstree",".jstree-anchor",n.proxy(function(i){this._data.contextmenu.visible&&(!t||i.timeStamp-t>250)&&n.vakata.context.hide()},this));n(document).on("context_hide.vakata",n.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&n.vakata.context.hide();r.teardown.call(this)};this.show_contextmenu=function(t,r,u,f){if(t=this.get_node(t),!t||t.id==="#")return!1;var s=this.settings.contextmenu,h=this.get_node(t,!0),c=h.children(".jstree-anchor"),o=!1,e=!1;(s.show_at_node||r===i||u===i)&&(o=c.offset(),r=o.left,u=o.top+this._data.core.li_height);this.settings.contextmenu.select_node&&!this.is_selected(t)&&this.activate_node(t,f);e=s.items;n.isFunction(e)&&(e=e.call(this,t,n.proxy(function(n){this._show_contextmenu(t,r,u,n)},this)));n.isPlainObject(e)&&this._show_contextmenu(t,r,u,e)};this._show_contextmenu=function(t,i,r,u){var f=this.get_node(t,!0),e=f.children(".jstree-anchor");n(document).one("context_show.vakata",n.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";n(i.element).addClass(r)},this));this._data.contextmenu.visible=!0;n.vakata.context.show(e,{x:i,y:r},u);this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(n){var i=!1,t={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};n.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(i){n(document).triggerHandler("context_"+i+".vakata",{reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}})},_execute:function(i){return i=t.items[i],i&&(!i._disabled||n.isFunction(i._disabled)&&!i._disabled({item:i,reference:t.reference,element:t.element}))&&i.action?i.action.call(null,{item:i,reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}}):!1},_parse:function(i,r){if(!i)return!1;r||(t.html="",t.items=[]);var u="",f=!1,e;return r&&(u+="<ul>"),n.each(i,function(i,r){if(!r)return!0;t.items.push(r);!f&&r.separator_before&&(u+="<li class='vakata-context-separator'><a href='#' "+(n.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<\/a><\/li>");f=!1;u+="<li class='"+(r._class||"")+(r._disabled===!0||n.isFunction(r._disabled)&&r._disabled({item:r,reference:t.reference,element:t.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">";u+="<a href='#' rel='"+(t.items.length-1)+"'>";n.vakata.context.settings.icons&&(u+="<i ",r.icon&&(u+=r.icon.indexOf("/")!==-1||r.icon.indexOf(".")!==-1?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),u+="><\/i><span class='vakata-contextmenu-sep'>&#160;<\/span>");u+=(n.isFunction(r.label)?r.label({item:i,reference:t.reference,element:t.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"<\/span>":"")+"<\/a>";r.submenu&&(e=n.vakata.context._parse(r.submenu,!0),e&&(u+=e));u+="<\/li>";r.separator_after&&(u+="<li class='vakata-context-separator'><a href='#' "+(n.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<\/a><\/li>",f=!0)}),u=u.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(u+="<\/ul>"),r||(t.html=u,n.vakata.context._trigger("parse")),u.length>10?u:!1},_show_submenu:function(t){if(t=n(t),t.length&&t.children("ul").length){var r=t.children("ul"),u=t.offset().left+t.outerWidth(),e=t.offset().top,f=r.width(),o=r.height(),s=n(window).width()+n(window).scrollLeft(),h=n(window).height()+n(window).scrollTop();i?t[u-(f+10+t.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):t[u+f+10>s?"addClass":"removeClass"]("vakata-context-right");e+o+10>h&&r.css("bottom","-1px");r.show()}},show:function(r,u,f){var h,o,e,s,c,l,a,v;t.element&&t.element.length&&t.element.width("");switch(!0){case!u&&!r:return!1;case!!u&&!!r:t.reference=r;t.position_x=u.x;t.position_y=u.y;break;case!u&&!!r:t.reference=r;h=r.offset();t.position_x=h.left+r.outerHeight();t.position_y=h.top;break;case!!u&&!r:t.position_x=u.x;t.position_y=u.y}!r||f||!n(r).data("vakata_contextmenu")||(f=n(r).data("vakata_contextmenu"));n.vakata.context._parse(f)&&t.element.html(t.html);t.items.length&&(o=t.element,e=t.position_x,s=t.position_y,c=o.width(),l=o.height(),a=n(window).width()+n(window).scrollLeft(),v=n(window).height()+n(window).scrollTop(),i&&(e-=o.outerWidth(),e<n(window).scrollLeft()+20&&(e=n(window).scrollLeft()+20)),e+c+20>a&&(e=a-(c+20)),s+l+20>v&&(s=v-(l+20)),t.element.css({left:e,top:s}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),t.is_visible=!0,n.vakata.context._trigger("show"))},hide:function(){t.is_visible&&(t.element.hide().find("ul").hide().end().find(":focus").blur(),t.is_visible=!1,n.vakata.context._trigger("hide"))}};n(function(){i=n("body").css("direction")==="rtl";var r=!1;t.element=n("<ul class='vakata-context'><\/ul>");t.element.on("mouseenter","li",function(i){(i.stopImmediatePropagation(),n.contains(this,i.relatedTarget))||(r&&clearTimeout(r),t.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),n(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),n.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){n.contains(this,t.relatedTarget)||n(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){n(this).find(".vakata-context-hover").removeClass("vakata-context-hover");n.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(){return function(){n.vakata.context.hide()}}(this),n.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault();n(this).blur().parent().hasClass("vakata-context-disabled")||n.vakata.context._execute(n(this).attr("rel"))===!1||n.vakata.context.hide()}).on("keydown","a",function(i){var r=null;switch(i.which){case 13:case 32:i.type="mouseup";i.preventDefault();n(i.currentTarget).trigger(i);break;case 37:t.is_visible&&(t.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 38:t.is_visible&&(r=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 39:t.is_visible&&(t.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 40:t.is_visible&&(r=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 27:n.vakata.context.hide();i.preventDefault()}}).on("keydown",function(n){n.preventDefault();var i=t.element.find(".vakata-contextmenu-shortcut-"+n.which).parent();i.parent().not(".vakata-context-disabled")&&i.mouseup()}).appendTo("body");n(document).on("mousedown",function(i){t.is_visible&&!n.contains(t.element[0],i.target)&&n.vakata.context.hide()}).on("context_show.vakata",function(){t.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");i&&t.element.addClass("vakata-context-rtl").css("direction","rtl");t.element.find("ul").hide().end()})})}(n))});