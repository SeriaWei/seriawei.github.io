(function(n){"use strict";typeof define=="function"&&define.amd?define("jstree.checkbox",["jquery","jstree"],n):typeof exports=="object"?n(require("jquery"),require("jstree")):n(jQuery,jQuery.jstree)})(function(n){"use strict";if(!n.jstree.plugins.checkbox){var t=document.createElement("I");t.className="jstree-icon jstree-checkbox";n.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:""};n.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this);this._data.checkbox.uto=!1;this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",n.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked")},this)).on("loading.jstree",n.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.cascade.indexOf("undetermined")!==-1)this.element.on("changed.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",n.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(n.proxy(this._undetermined,this),50)},this));if(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1)this.element.on("model.jstree",n.proxy(function(t,i){var f=this._model.data,u=f[i.parent],o=i.nodes,h=[],a,r,e,s,c,l,v=this.settings.checkbox.cascade;if(v.indexOf("down")!==-1)if(u.state.selected){for(r=0,e=o.length;r<e;r++)f[o[r]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(o)}else for(r=0,e=o.length;r<e;r++)if(f[o[r]].state.selected){for(s=0,c=f[o[r]].children_d.length;s<c;s++)f[f[o[r]].children_d[s]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(f[o[r]].children_d)}if(v.indexOf("up")!==-1){for(r=0,e=u.children_d.length;r<e;r++)f[u.children_d[r]].children.length||h.push(f[u.children_d[r]].parent);for(h=n.vakata.array_unique(h),s=0,c=h.length;s<c;s++)for(u=f[h[s]];u&&u.id!=="#";){for(a=0,r=0,e=u.children.length;r<e;r++)a+=f[u.children[r]].state.selected;if(a===e)u.state.selected=!0,this._data.core.selected.push(u.id),l=this.get_node(u,!0),l&&l.length&&l.children(".jstree-anchor").addClass("jstree-clicked");else break;u=this.get_node(u.parent)}}this._data.core.selected=n.vakata.array_unique(this._data.core.selected)},this)).on("select_node.jstree",n.proxy(function(t,i){var e=i.node,c=this._model.data,u=this.get_node(e.parent),l=this.get_node(e,!0),f,o,s,r,h=this.settings.checkbox.cascade;if(h.indexOf("down")!==-1)for(this._data.core.selected=n.vakata.array_unique(this._data.core.selected.concat(e.children_d)),f=0,o=e.children_d.length;f<o;f++)r=c[e.children_d[f]],r.state.selected=!0,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1);if(h.indexOf("up")!==-1)while(u&&u.id!=="#"){for(s=0,f=0,o=u.children.length;f<o;f++)s+=c[u.children[f]].state.selected;if(s===o)u.state.selected=!0,this._data.core.selected.push(u.id),r=this.get_node(u,!0),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-clicked");else break;u=this.get_node(u.parent)}h.indexOf("down")!==-1&&l.length&&l.find(".jstree-anchor").addClass("jstree-clicked")},this)).on("deselect_all.jstree",n.proxy(function(){for(var i=this.get_node("#"),u=this._model.data,n,t=0,r=i.children_d.length;t<r;t++)n=u[i.children_d[t]],n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on("deselect_node.jstree",n.proxy(function(t,i){var f=i.node,s=this.get_node(f,!0),u,e,r,o=this.settings.checkbox.cascade;if(f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1),o.indexOf("down")!==-1)for(u=0,e=f.children_d.length;u<e;u++)r=this._model.data[f.children_d[u]],r.state.selected=!1,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1);if(o.indexOf("up")!==-1)for(u=0,e=f.parents.length;u<e;u++)r=this._model.data[f.parents[u]],r.state.selected=!1,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1),r=this.get_node(f.parents[u],!0),r&&r.length&&r.children(".jstree-anchor").removeClass("jstree-clicked");for(r=[],u=0,e=this._data.core.selected.length;u<e;u++)(o.indexOf("down")===-1||n.inArray(this._data.core.selected[u],f.children_d)===-1)&&(o.indexOf("up")===-1||n.inArray(this._data.core.selected[u],f.parents)===-1)&&r.push(this._data.core.selected[u]);this._data.core.selected=n.vakata.array_unique(r);o.indexOf("down")!==-1&&s.length&&s.find(".jstree-anchor").removeClass("jstree-clicked")},this));if(this.settings.checkbox.cascade.indexOf("up")!==-1)this.element.on("delete_node.jstree",n.proxy(function(n,t){for(var i=this.get_node(t.parent),o=this._model.data,r,f,e,u;i&&i.id!=="#";){for(e=0,r=0,f=i.children.length;r<f;r++)e+=o[i.children[r]].state.selected;if(e===f)i.state.selected=!0,this._data.core.selected.push(i.id),u=this.get_node(i,!0),u&&u.length&&u.children(".jstree-anchor").addClass("jstree-clicked");else break;i=this.get_node(i.parent)}},this)).on("move_node.jstree",n.proxy(function(t,i){var h=i.is_multi,c=i.old_parent,l=this.get_node(i.parent),s=this._model.data,r,e,f,o,u;if(!h)for(r=this.get_node(c);r&&r.id!=="#";){for(e=0,f=0,o=r.children.length;f<o;f++)e+=s[r.children[f]].state.selected;if(e===o)r.state.selected=!0,this._data.core.selected.push(r.id),u=this.get_node(r,!0),u&&u.length&&u.children(".jstree-anchor").addClass("jstree-clicked");else break;r=this.get_node(r.parent)}for(r=l;r&&r.id!=="#";){for(e=0,f=0,o=r.children.length;f<o;f++)e+=s[r.children[f]].state.selected;if(e===o)r.state.selected||(r.state.selected=!0,this._data.core.selected.push(r.id),u=this.get_node(r,!0),u&&u.length&&u.children(".jstree-anchor").addClass("jstree-clicked"));else if(r.state.selected)r.state.selected=!1,this._data.core.selected=n.vakata.array_remove_item(this._data.core.selected,r.id),u=this.get_node(r,!0),u&&u.length&&u.children(".jstree-anchor").removeClass("jstree-clicked");else break;r=this.get_node(r.parent)}},this))};this._undetermined=function(){for(var f=this._model.data,r=this._data.core.selected,i=[],e=this,t=0,u=r.length;t<u;t++)f[r[t]]&&f[r[t]].parents&&(i=i.concat(f[r[t]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var n=e.get_node(this),r;if(n.state.loaded)for(t=0,u=n.children_d.length;t<u;t++)r=f[n.children_d[t]],!r.state.loaded&&r.original&&r.original.state&&r.original.state.undetermined&&r.original.state.undetermined===!0&&(i.push(r.id),i=i.concat(r.parents));else n.original&&n.original.state&&n.original.state.undetermined&&n.original.state.undetermined===!0&&(i.push(n.id),i=i.concat(n.parents))}),i=n.vakata.array_unique(i),i=n.vakata.array_remove_item(i,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),t=0,u=i.length;t<u;t++)f[i[t]].state.selected||(r=this.get_node(i[t],!0),r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))};this.redraw_node=function(i,u,f){if(i=r.redraw_node.call(this,i,u,f),i){for(var o=null,e=0,s=i.childNodes.length;e<s;e++)if(i.childNodes[e]&&i.childNodes[e].className&&i.childNodes[e].className.indexOf("jstree-anchor")!==-1){o=i.childNodes[e];break}o&&o.insertBefore(t.cloneNode(!1),o.childNodes[0])}return f||this.settings.checkbox.cascade.indexOf("undetermined")===-1||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(n.proxy(this._undetermined,this),50)),i};this.activate_node=function(t,i){return(this.settings.checkbox.whole_node||n(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),r.activate_node.call(this,t,i)};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()}}}});