(function(n){"use strict";typeof define=="function"&&define.amd?define("jstree.types",["jquery","jstree"],n):typeof exports=="object"?n(require("jquery"),require("jstree")):n(jQuery,jQuery.jstree)})(function(n,t,i){"use strict";n.jstree.plugins.types||(n.jstree.defaults.types={"#":{},"default":{}},n.jstree.plugins.types=function(t,r){this.init=function(n,t){var u,f;if(t&&t.types&&t.types["default"])for(u in t.types)if(u!=="default"&&u!=="#"&&t.types.hasOwnProperty(u))for(f in t.types["default"])t.types["default"].hasOwnProperty(f)&&t.types[u][f]===i&&(t.types[u][f]=t.types["default"][f]);r.init.call(this,n,t);this._model.data["#"].type="#"};this.refresh=function(n){r.refresh.call(this,n);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",n.proxy(function(n,t){for(var u=this._model.data,f=t.nodes,o=this.settings.types,e="default",r=0,s=f.length;r<s;r++)e="default",u[f[r]].original&&u[f[r]].original.type&&o[u[f[r]].original.type]&&(e=u[f[r]].original.type),u[f[r]].data&&u[f[r]].data.jstree&&u[f[r]].data.jstree.type&&o[u[f[r]].data.jstree.type]&&(e=u[f[r]].data.jstree.type),u[f[r]].type=e,u[f[r]].icon===!0&&o[e].icon!==i&&(u[f[r]].icon=o[e].icon);u["#"].type="#"},this));r.bind.call(this)};this.get_json=function(t,i,u){var e,s,o=this._model.data,h=i?n.extend(!0,{},i,{no_id:!1}):{},f=r.get_json.call(this,t,h,u);if(f===!1)return!1;if(n.isArray(f))for(e=0,s=f.length;e<s;e++)f[e].type=f[e].id&&o[f[e].id]&&o[f[e].id].type?o[f[e].id].type:"default",i&&i.no_id&&(delete f[e].id,f[e].li_attr&&f[e].li_attr.id&&delete f[e].li_attr.id);else f.type=f.id&&o[f.id]&&o[f.id].type?o[f.id].type:"default",i&&i.no_id&&(f=this._delete_ids(f));return f};this._delete_ids=function(t){if(n.isArray(t)){for(var i=0,r=t.length;i<r;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.children&&n.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t};this.check=function(t,u,f,e,o){if(r.check.call(this,t,u,f,e,o)===!1)return!1;u=u&&u.id?u:this.get_node(u);f=f&&f.id?f:this.get_node(f);var c=u&&u.id?n.jstree.reference(u.id):null,s,h,l,a;c=c&&c._model&&c._model.data?c._model.data:null;switch(t){case"create_node":case"move_node":case"copy_node":if(t!=="move_node"||n.inArray(u.id,f.children)===-1){if(s=this.get_rules(f),s.max_children!==i&&s.max_children!==-1&&s.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+t,data:JSON.stringify({chk:t,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;if(s.valid_children!==i&&s.valid_children!==-1&&n.inArray(u.type,s.valid_children)===-1)return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+t,data:JSON.stringify({chk:t,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;if(c&&u.children_d&&u.parents){for(h=0,l=0,a=u.children_d.length;l<a;l++)h=Math.max(h,c[u.children_d[l]].parents.length);h=h-u.parents.length+1}(h<=0||h===i)&&(h=1);do{if(s.max_depth!==i&&s.max_depth!==-1&&s.max_depth<h)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+t,data:JSON.stringify({chk:t,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent);s=this.get_rules(f);h++}while(f)}}return!0};this.get_rules=function(n){if(n=this.get_node(n),!n)return!1;var t=this.get_type(n,!0);return t.max_depth===i&&(t.max_depth=-1),t.max_children===i&&(t.max_children=-1),t.valid_children===i&&(t.valid_children=-1),t};this.get_type=function(t,i){return t=this.get_node(t),t?i?n.extend({type:t.type},this.settings.types[t.type]):t.type:!1};this.set_type=function(t,r){var u,f,s,e,o;if(n.isArray(t)){for(t=t.slice(),f=0,s=t.length;f<s;f++)this.set_type(t[f],r);return!0}return(u=this.settings.types,t=this.get_node(t),!u[r]||!t)?!1:(e=t.type,o=this.get_icon(t),t.type=r,(o===!0||u[e]&&u[e].icon&&o===u[e].icon)&&this.set_icon(t,u[r].icon!==i?u[r].icon:!0),!0)}})});