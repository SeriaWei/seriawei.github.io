/*!
 * jsTree {{VERSION}}
 * http://jstree.com/
 *
 * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
 *
 * Licensed same as jquery - under the terms of the MIT License
 *   http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * if using jslint please allow for the jQuery global and use following options: 
 * jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 */
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery"],n):typeof exports=="object"?n(require("jquery")):n(jQuery)})(function(n,t){"use strict";if(!n.jstree){var l=0,u=!1,i=!1,f=!1,c=[],h=n("script:last").attr("src"),e=document,o=e.createElement("LI"),r,s;o.setAttribute("role","treeitem");r=e.createElement("I");r.className="jstree-icon jstree-ocl";o.appendChild(r);r=e.createElement("A");r.className="jstree-anchor";r.setAttribute("href","#");s=e.createElement("I");s.className="jstree-icon jstree-themeicon";r.appendChild(s);o.appendChild(r);r=s=null;n.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:h&&h.indexOf("/")!==-1?h.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}]/g};n.jstree.create=function(t,i){var r=new n.jstree.core(++l),u=i;return i=n.extend(!0,{},n.jstree.defaults,i),u&&u.plugins&&(i.plugins=u.plugins),n.each(i.plugins,function(n,t){n!=="core"&&(r=r.plugin(t,i[t]))}),r.init(t,i),r};n.jstree.core=function(n){this._id=n;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{}}}};n.jstree.reference=function(t){var r=null,i=null;if(t&&t.id&&(t=t.id),!i||!i.length)try{i=n(t)}catch(u){}if(!i||!i.length)try{i=n("#"+t.replace(n.jstree.idregex,"\\$&"))}catch(u){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?r=i:n(".jstree").each(function(){var i=n(this).data("jstree");if(i&&i._model.data[t])return r=i,!1}),r};n.fn.jstree=function(i){var u=typeof i=="string",f=Array.prototype.slice.call(arguments,1),r=null;return this.each(function(){var e=n.jstree.reference(this),o=u&&e?e[i]:null;return r=u&&o?o.apply(e,f):null,e||u||i!==t&&!n.isPlainObject(i)||n(this).data("jstree",new n.jstree.create(this,i)),(e&&!u||i===!0)&&(r=e||!1),r!==null&&r!==t?!1:void 0}),r!==null&&r!==t?r:this};n.expr[":"].jstree=n.expr.createPseudo(function(){return function(i){return n(i).hasClass("jstree")&&n(i).data("jstree")!==t}});n.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:n.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0};n.jstree.core.prototype={plugin:function(t,i){var r=n.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this.element=n(t).addClass("jstree jstree-"+this._id);this.settings=i;this.element.bind("destroyed",n.proxy(this.teardown,this));this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl=this.element.css("direction")==="rtl";this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<ul class='jstree-container-ul jstree-children'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'><\/i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'><\/i>"+this.get_string("Loading ...")+"<\/a><\/li><\/ul>");this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24;this.trigger("loading");this.load_node("#")},destroy:function(n){n||this.element.empty();this.element.unbind("destroyed",this.teardown);this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var n=window.getSelection();try{n.removeAllRanges();n.collapse()}catch(t){}}}).on("click.jstree",".jstree-ocl",n.proxy(function(n){this.toggle_node(n.target)},this)).on("click.jstree",".jstree-anchor",n.proxy(function(t){t.preventDefault();n(t.currentTarget).focus();this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",n.proxy(function(t){if(t.target.tagName==="INPUT")return!0;var i=null;switch(t.which){case 13:case 32:t.type="click";n(t.currentTarget).trigger(t);break;case 37:t.preventDefault();this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_prev_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus());break;case 38:t.preventDefault();i=this.get_prev_dom(t.currentTarget);i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault();this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(n){this.get_node(n,!0).children(".jstree-anchor").focus()}):(i=this.get_next_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus());break;case 40:t.preventDefault();i=this.get_next_dom(t.currentTarget);i&&i.length&&i.children(".jstree-anchor").focus();break;case 46:t.preventDefault();i=this.get_node(t.currentTarget);i&&i.id&&i.id!=="#"&&(i=this.is_selected(i)?this.get_selected():i);break;case 113:t.preventDefault();i=this.get_node(t.currentTarget);
/*!
								if(o && o.id && o.id !== '#') {
									// this.edit(o);
								}
								*/
}},this)).on("load_node.jstree",n.proxy(function(t,i){if(i.status&&(i.node.id!=="#"||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){for(var u=[],r=0,f=this._data.core.selected.length;r<f;r++)u=u.concat(this._model.data[this._data.core.selected[r]].parents);for(u=n.vakata.array_unique(u),r=0,f=u.length;r<f;r++)this.open_node(u[r],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(n.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",n.proxy(function(){var n=this.settings.core.themes;this._data.core.themes.dots=n.dots;this._data.core.themes.stripes=n.stripes;this._data.core.themes.icons=n.icons;this.set_theme(n.name||"default",n.url);this.set_theme_variant(n.variant)},this)).on("loading.jstree",n.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",n.proxy(function(t){n(t.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",n.proxy(function(t){this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave();n(t.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",n.proxy(function(n){this.hover_node(n.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",n.proxy(function(n){this.dehover_node(n.currentTarget)},this))},unbind:function(){this.element.off(".jstree");n(document).off(".jstree-"+this._id)},trigger:function(n,t){t||(t={});t.instance=this;this.element.triggerHandler(n.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(t){var i=this.settings.core.strings;return n.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(n){for(n=n?n.firstChild:null;n!==null&&n.nodeType!==1;)n=n.nextSibling;return n},_nextSibling:function(n){for(n=n?n.nextSibling:null;n!==null&&n.nodeType!==1;)n=n.nextSibling;return n},_previousSibling:function(n){for(n=n?n.previousSibling:null;n!==null&&n.nodeType!==1;)n=n.previousSibling;return n},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if(((r=n(t,this.element)).length||(r=n("#"+t.replace(n.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=n(t,this.element)).length&&r.hasClass("jstree"))t=this._model.data["#"];else return!1;return i&&(t=t.id==="#"?this.element:n("#"+t.id.replace(n.jstree.idregex,"\\$&"),this.element)),t}catch(u){return!1}},get_path:function(n,t,i){if(n=n.parents?n:this.get_node(n),!n||n.id==="#"||!n.parents)return!1;var u,f,r=[];for(r.push(i?n.id:n.text),u=0,f=n.parents.length;u<f;u++)r.push(i?n.parents[u]:this.get_text(n.parents[u]));return r=r.reverse().slice(1),t?r.join(t):r},get_next_dom:function(t,i){var r;return(t=this.get_node(t,!0),t[0]===this.element[0])?(r=this._firstChild(this.get_container_ul()[0]),r?n(r):!1):!t||!t.length?!1:i?(r=this._nextSibling(t[0]),r?n(r):!1):t.hasClass("jstree-open")?(r=this._firstChild(t.children(".jstree-children")[0]),r?n(r):!1):(r=this._nextSibling(t[0]))!==null?n(r):t.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0)},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0])return r=this.get_container_ul()[0].lastChild,r?n(r):!1;if(!t||!t.length)return!1;if(i)return r=this._previousSibling(t[0]),r?n(r):!1;if((r=this._previousSibling(t[0]))!==null){for(t=n(r);t.hasClass("jstree-open");)t=t.children(".jstree-children:eq(0)").children(".jstree-node:last");return t}return r=t[0].parentNode.parentNode,r&&r.className&&r.className.indexOf("jstree-node")!==-1?n(r):!1},get_parent:function(n){return(n=this.get_node(n),!n||n.id==="#")?!1:n.parent},get_children_dom:function(n){return(n=this.get_node(n,!0),n[0]===this.element[0])?this.get_container_ul().children(".jstree-node"):!n||!n.length?!1:n.children(".jstree-children").children(".jstree-node")},is_parent:function(n){return n=this.get_node(n),n&&(n.state.loaded===!1||n.children.length>0)},is_loaded:function(n){return n=this.get_node(n),n&&n.state.loaded},is_loading:function(n){return n=this.get_node(n),n&&n.state&&n.state.loading},is_open:function(n){return n=this.get_node(n),n&&n.state.opened},is_closed:function(n){return n=this.get_node(n),n&&this.is_parent(n)&&!n.state.opened},is_leaf:function(n){return!this.is_parent(n)},load_node:function(t,i){var r,f,u,e,o;if(n.isArray(t))return this._load_nodes(t.slice(),i),!0;if(t=this.get_node(t),!t)return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,r=0,f=t.children_d.length;r<f;r++){for(u=0,e=t.parents.length;u<e;u++)this._model.data[t.parents[u]].children_d=n.vakata.array_remove_item(this._model.data[t.parents[u]].children_d,t.children_d[r]);this._model.data[t.children_d[r]].state.selected&&(o=!0,this._data.core.selected=n.vakata.array_remove_item(this._data.core.selected,t.children_d[r]));delete this._model.data[t.children_d[r]]}t.children=[];t.children_d=[];o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading"),this._load_node(t,n.proxy(function(n){t=this._model.data[t.id];t.state.loading=!1;t.state.loaded=n;var r=this.get_node(t,!0);t.state.loaded&&!t.children.length&&r&&r.length&&!r.hasClass("jstree-leaf")&&r.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");r.removeClass("jstree-loading");this.trigger("load_node",{node:t,status:n});i&&i.call(this,t,n)},this)),!0},_load_nodes:function(n,t,i){for(var u=!0,o=function(){this._load_nodes(n,t,!0)},f=this._model.data,r=0,e=n.length;r<e;r++)!f[n[r]]||f[n[r]].state.loaded&&i||(this.is_loading(n[r])||this.load_node(n[r],o),u=!1);u&&(t.done||(t.call(this,n),t.done=!0))},_load_node:function(t,i){var r=this.settings.core.data,u;return r?n.isFunction(r)?r.call(this,t,n.proxy(function(r){r===!1&&i.call(this,!1);this[typeof r=="string"?"_append_html_data":"_append_json_data"](t,typeof r=="string"?n(r):r,function(n){i.call(this,n)})},this)):typeof r=="object"?r.url?(r=n.extend(!0,{},r),n.isFunction(r.url)&&(r.url=r.url.call(this,t)),n.isFunction(r.data)&&(r.data=r.data.call(this,t)),n.ajax(r).done(n.proxy(function(r,u,f){var e=f.getResponseHeader("Content-Type");return e.indexOf("json")!==-1||typeof r=="object"?this._append_json_data(t,r,function(n){i.call(this,n)}):e.indexOf("html")!==-1||typeof r=="string"?this._append_html_data(t,n(r),function(n){i.call(this,n)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:f})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(n.proxy(function(n){i.call(this,!1);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})};this.settings.core.error.call(this,this._data.core.last_error)},this))):(u=n.isArray(r)||n.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,t.id==="#"?this._append_json_data(t,u,function(n){i.call(this,n)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):typeof r=="string"?t.id==="#"?this._append_html_data(t,n(r),function(n){i.call(this,n)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id==="#"?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(n){i.call(this,n)}):i.call(this,!1)},_node_changed:function(n){n=this.get_node(n);n&&this._model.changed.push(n.id)},_append_html_data:function(t,i,r){t=this.get_node(t);t.children=[];t.children_d=[];var a=i.is("ul")?i.children():i,o=t.id,c=[],u=[],s=this._model.data,f=s[o],v=this._data.core.selected.length,e,h,l;for(a.each(n.proxy(function(t,i){e=this._parse_model_from_html(n(i),o,f.parents.concat());e&&(c.push(e),u.push(e),s[e].children_d.length&&(u=u.concat(s[e].children_d)))},this)),f.children=c,f.children_d=u,h=0,l=f.parents.length;h<l;h++)s[f.parents[h]].children_d=s[f.parents[h]].children_d.concat(u);this.trigger("model",{nodes:u,parent:o});o!=="#"?(this._node_changed(o),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==v&&this.trigger("changed",{action:"model",selected:this._data.core.selected});r.call(this,!0)},_append_json_data:function(t,i,r){t=this.get_node(t);t.children=[];t.children_d=[];i.d&&(i=i.d,typeof i=="string"&&(i=JSON.parse(i)));n.isArray(i)||(i=[i]);var u=null,f={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},e=function(n,t){n.data&&(n=n.data);var u=n.dat,c=n.par,y=[],f=[],l=[],h=n.df,k=n.t_id,a=n.t_cnt,r=n.m,e=r[c],p=n.sel,o,i,s,v,w=function(n,i,u){u=u?u.concat():[];i&&u.unshift(i);var c=n.id.toString(),f,a,o,s,e={id:c,text:n.text||"",icon:n.icon!==t?n.icon:!0,parent:i,parents:u,children:n.children||[],children_d:n.children_d||[],data:n.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in h)h.hasOwnProperty(f)&&(e.state[f]=h[f]);if(n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(e.icon=n.data.jstree.icon),n&&n.data&&(e.data=n.data,n.data.jstree))for(f in n.data.jstree)n.data.jstree.hasOwnProperty(f)&&(e.state[f]=n.data.jstree[f]);if(n&&typeof n.state=="object")for(f in n.state)n.state.hasOwnProperty(f)&&(e.state[f]=n.state[f]);if(n&&typeof n.li_attr=="object")for(f in n.li_attr)n.li_attr.hasOwnProperty(f)&&(e.li_attr[f]=n.li_attr[f]);if(e.li_attr.id||(e.li_attr.id=c),n&&typeof n.a_attr=="object")for(f in n.a_attr)n.a_attr.hasOwnProperty(f)&&(e.a_attr[f]=n.a_attr[f]);for(n&&n.children&&n.children===!0&&(e.state.loaded=!1,e.children=[],e.children_d=[]),r[e.id]=e,f=0,a=e.children.length;f<a;f++)o=w(r[e.children[f]],e.id,u),s=r[o],e.children_d.push(o),s.children_d.length&&(e.children_d=e.children_d.concat(s.children_d));return delete n.data,delete n.children,r[e.id].original=n,e.state.selected&&l.push(e.id),e.id},b=function(n,i,u){u=u?u.concat():[];i&&u.unshift(i);var o=!1,e,v,s,c,f;do o="j"+k+"_"+ ++a;while(r[o]);f={id:!1,text:typeof n=="string"?n:"",icon:typeof n=="object"&&n.icon!==t?n.icon:!0,parent:i,parents:u,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in h)h.hasOwnProperty(e)&&(f.state[e]=h[e]);if(n&&n.id&&(f.id=n.id.toString()),n&&n.text&&(f.text=n.text),n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(f.icon=n.data.jstree.icon),n&&n.data&&(f.data=n.data,n.data.jstree))for(e in n.data.jstree)n.data.jstree.hasOwnProperty(e)&&(f.state[e]=n.data.jstree[e]);if(n&&typeof n.state=="object")for(e in n.state)n.state.hasOwnProperty(e)&&(f.state[e]=n.state[e]);if(n&&typeof n.li_attr=="object")for(e in n.li_attr)n.li_attr.hasOwnProperty(e)&&(f.li_attr[e]=n.li_attr[e]);if(f.li_attr.id&&!f.id&&(f.id=f.li_attr.id.toString()),f.id||(f.id=o),f.li_attr.id||(f.li_attr.id=f.id),n&&typeof n.a_attr=="object")for(e in n.a_attr)n.a_attr.hasOwnProperty(e)&&(f.a_attr[e]=n.a_attr[e]);if(n&&n.children&&n.children.length){for(e=0,v=n.children.length;e<v;e++)s=b(n.children[e],f.id,u),c=r[s],f.children.push(s),c.children_d.length&&(f.children_d=f.children_d.concat(c.children_d));f.children_d=f.children_d.concat(f.children)}return n&&n.children&&n.children===!0&&(f.state.loaded=!1,f.children=[],f.children_d=[]),delete n.data,delete n.children,f.original=n,r[f.id]=f,f.state.selected&&l.push(f.id),f.id};if(u.length&&u[0].id!==t&&u[0].parent!==t){for(i=0,s=u.length;i<s;i++)u[i].children||(u[i].children=[]),r[u[i].id.toString()]=u[i];for(i=0,s=u.length;i<s;i++)r[u[i].parent.toString()].children.push(u[i].id.toString()),e.children_d.push(u[i].id.toString());for(i=0,s=e.children.length;i<s;i++)o=w(r[e.children[i]],c,e.parents.concat()),f.push(o),r[o].children_d.length&&(f=f.concat(r[o].children_d));v={cnt:a,mod:r,sel:p,par:c,dpc:f,add:l}}else{for(i=0,s=u.length;i<s;i++)o=b(u[i],c,e.parents.concat()),o&&(y.push(o),f.push(o),r[o].children_d.length&&(f=f.concat(r[o].children_d)));for(e.children=y,e.children_d=f,i=0,s=e.parents.length;i<s;i++)r[e.parents[i]].children_d=r[e.parents[i]].children_d.concat(f);v={cnt:a,mod:r,sel:p,par:c,dpc:f,add:l}}return v},o=function(t,i){if(this._cnt=t.cnt,this._model.data=t.mod,i){var u,o,h=t.add,f=t.sel,e=this._data.core.selected.slice(),s=this._model.data;if(f.length!==e.length||n.vakata.array_unique(f.concat(e)).length!==f.length){for(u=0,o=f.length;u<o;u++)n.inArray(f[u],h)===-1&&n.inArray(f[u],e)===-1&&(s[f[u]].state.selected=!1);for(u=0,o=e.length;u<o;u++)n.inArray(e[u],f)===-1&&(s[e[u]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add));this.trigger("model",{nodes:t.dpc,parent:t.par});t.par!=="#"?(this._node_changed(t.par),this.redraw()):this.redraw(!0);t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});r.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{this._wrk===null&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+e.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"})));u=new window.Worker(this._wrk);u.onmessage=n.proxy(function(n){o.call(this,n.data,!0)},this);u.postMessage(f)}catch(s){o.call(this,e(f),!1)}else o.call(this,e(f),!1)},_parse_model_from_html:function(t,i,r){r=r?[].concat(r):[];i&&r.unshift(i);var o,s,c=this._model.data,u={id:!1,text:!1,icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},e,f,h;for(e in this._model.default_state)this._model.default_state.hasOwnProperty(e)&&(u.state[e]=this._model.default_state[e]);if(f=n.vakata.attributes(t,!0),n.each(f,function(t,i){if(i=n.trim(i),!i.length)return!0;u.li_attr[t]=i;t==="id"&&(u.id=i.toString())}),f=t.children("a").eq(0),f.length&&(f=n.vakata.attributes(f,!0),n.each(f,function(t,i){i=n.trim(i);i.length&&(u.a_attr[t]=i)})),f=t.children("a:eq(0)").length?t.children("a:eq(0)").clone():t.clone(),f.children("ins, i, ul").remove(),f=f.html(),f=n("<div />").html(f),u.text=f.html(),f=t.data(),u.data=f?n.extend(!0,{},f):null,u.state.opened=t.hasClass("jstree-open"),u.state.selected=t.children("a").hasClass("jstree-clicked"),u.state.disabled=t.children("a").hasClass("jstree-disabled"),u.data&&u.data.jstree)for(e in u.data.jstree)u.data.jstree.hasOwnProperty(e)&&(u.state[e]=u.data.jstree[e]);f=t.children("a").children(".jstree-themeicon");f.length&&(u.icon=f.hasClass("jstree-themeicon-hidden")?!1:f.attr("rel"));u.state.icon&&(u.icon=u.state.icon);f=t.children("ul").children("li");do h="j"+this._id+"_"+ ++this._cnt;while(c[h]);return u.id=u.li_attr.id?u.li_attr.id.toString():h,f.length?(f.each(n.proxy(function(t,i){o=this._parse_model_from_html(n(i),u.id,r);s=this._model.data[o];u.children.push(o);s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d))},this)),u.children_d=u.children_d.concat(u.children)):t.hasClass("jstree-closed")&&(u.state.loaded=!1),u.li_attr["class"]&&(u.li_attr["class"]=u.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),u.a_attr["class"]&&(u.a_attr["class"]=u.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),c[u.id]=u,u.state.selected&&this._data.core.selected.push(u.id),u.id},_parse_model_from_flat_json:function(n,i,r){r=r?r.concat():[];i&&r.unshift(i);var c=n.id.toString(),e=this._model.data,o=this._model.default_state,u,l,s,h,f={id:c,text:n.text||"",icon:n.icon!==t?n.icon:!0,parent:i,parents:r,children:n.children||[],children_d:n.children_d||[],data:n.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(u in o)o.hasOwnProperty(u)&&(f.state[u]=o[u]);if(n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(f.icon=n.data.jstree.icon),n&&n.data&&(f.data=n.data,n.data.jstree))for(u in n.data.jstree)n.data.jstree.hasOwnProperty(u)&&(f.state[u]=n.data.jstree[u]);if(n&&typeof n.state=="object")for(u in n.state)n.state.hasOwnProperty(u)&&(f.state[u]=n.state[u]);if(n&&typeof n.li_attr=="object")for(u in n.li_attr)n.li_attr.hasOwnProperty(u)&&(f.li_attr[u]=n.li_attr[u]);if(f.li_attr.id||(f.li_attr.id=c),n&&typeof n.a_attr=="object")for(u in n.a_attr)n.a_attr.hasOwnProperty(u)&&(f.a_attr[u]=n.a_attr[u]);for(n&&n.children&&n.children===!0&&(f.state.loaded=!1,f.children=[],f.children_d=[]),e[f.id]=f,u=0,l=f.children.length;u<l;u++)s=this._parse_model_from_flat_json(e[f.children[u]],f.id,r),h=e[s],f.children_d.push(s),h.children_d.length&&(f.children_d=f.children_d.concat(h.children_d));return delete n.data,delete n.children,e[f.id].original=n,f.state.selected&&this._data.core.selected.push(f.id),f.id},_parse_model_from_json:function(n,i,r){r=r?r.concat():[];i&&r.unshift(i);var e=!1,f,l,o,s,h=this._model.data,c=this._model.default_state,u;do e="j"+this._id+"_"+ ++this._cnt;while(h[e]);u={id:!1,text:typeof n=="string"?n:"",icon:typeof n=="object"&&n.icon!==t?n.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in c)c.hasOwnProperty(f)&&(u.state[f]=c[f]);if(n&&n.id&&(u.id=n.id.toString()),n&&n.text&&(u.text=n.text),n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(u.icon=n.data.jstree.icon),n&&n.data&&(u.data=n.data,n.data.jstree))for(f in n.data.jstree)n.data.jstree.hasOwnProperty(f)&&(u.state[f]=n.data.jstree[f]);if(n&&typeof n.state=="object")for(f in n.state)n.state.hasOwnProperty(f)&&(u.state[f]=n.state[f]);if(n&&typeof n.li_attr=="object")for(f in n.li_attr)n.li_attr.hasOwnProperty(f)&&(u.li_attr[f]=n.li_attr[f]);if(u.li_attr.id&&!u.id&&(u.id=u.li_attr.id.toString()),u.id||(u.id=e),u.li_attr.id||(u.li_attr.id=u.id),n&&typeof n.a_attr=="object")for(f in n.a_attr)n.a_attr.hasOwnProperty(f)&&(u.a_attr[f]=n.a_attr[f]);if(n&&n.children&&n.children.length){for(f=0,l=n.children.length;f<l;f++)o=this._parse_model_from_json(n.children[f],u.id,r),s=h[o],u.children.push(o),s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d));u.children_d=u.children_d.concat(u.children)}return n&&n.children&&n.children===!0&&(u.state.loaded=!1,u.children=[],u.children_d=[]),delete n.data,delete n.children,u.original=n,h[u.id]=u,u.state.selected&&this._data.core.selected.push(u.id),u.id},_redraw:function(){for(var t=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),i=document.createElement("UL"),r,n=0,u=t.length;n<u;n++)r=this.redraw_node(t[n],!0,this._model.force_full_redraw),r&&this._model.force_full_redraw&&i.appendChild(r);this._model.force_full_redraw&&(i.className=this.get_container_ul()[0].className,this.element.empty().append(i));this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:t})},redraw:function(n){n&&(this._model.force_full_redraw=!0);this._redraw()},redraw_node:function(t,i,r){var u=this.get_node(t),f=!1,v=!1,y=!1,e=!1,s=!1,l=!1,h="",w=document,a=this._model.data,b=!1,p=!1,c=null;if(!u)return!1;if(u.id==="#")return this.redraw(!0);if(i=i||u.children.length===0,t=document.querySelector?this.element[0].querySelector("#"+("0123456789".indexOf(u.id[0])!==-1?"\\3"+u.id[0]+" "+u.id.substr(1).replace(n.jstree.idregex,"\\$&"):u.id.replace(n.jstree.idregex,"\\$&"))):document.getElementById(u.id),t)t=n(t),r||(f=t.parent().parent()[0],f===this.element[0]&&(f=null),v=t.index()),i||!u.children.length||t.children(".jstree-children").length||(i=!0),i||(y=t.children(".jstree-children")[0]),p=t.attr("aria-selected"),b=t.children(".jstree-anchor")[0]===document.activeElement,t.remove();else if(i=!0,!r){if(f=u.parent!=="#"?n("#"+u.parent.replace(n.jstree.idregex,"\\$&"),this.element)[0]:null,f!==null&&(!f||!a[u.parent].state.opened))return!1;v=n.inArray(u.id,f===null?a["#"].children:a[u.parent].children)}t=o.cloneNode(!0);h="jstree-node ";for(e in u.li_attr)if(u.li_attr.hasOwnProperty(e)){if(e==="id")continue;e!=="class"?t.setAttribute(e,u.li_attr[e]):h+=u.li_attr[e]}p&&p!=="false"&&t.setAttribute("aria-selected",!0);u.state.loaded&&!u.children.length?h+=" jstree-leaf":(h+=u.state.opened&&u.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",u.state.opened&&u.state.loaded));u.parent!==null&&a[u.parent].children[a[u.parent].children.length-1]===u.id&&(h+=" jstree-last");t.id=u.id;t.className=h;h=(u.state.selected?" jstree-clicked":"")+(u.state.disabled?" jstree-disabled":"");for(s in u.a_attr)if(u.a_attr.hasOwnProperty(s)){if(s==="href"&&u.a_attr[s]==="#")continue;s!=="class"?t.childNodes[1].setAttribute(s,u.a_attr[s]):h+=" "+u.a_attr[s]}if(h.length&&(t.childNodes[1].className="jstree-anchor "+h),(u.icon&&u.icon!==!0||u.icon===!1)&&(u.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":u.icon.indexOf("/")===-1&&u.icon.indexOf(".")===-1?t.childNodes[1].childNodes[0].className+=" "+u.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+u.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),t.childNodes[1].innerHTML+=u.text,i&&u.children.length&&u.state.opened&&u.state.loaded){for(l=w.createElement("UL"),l.setAttribute("role","group"),l.className="jstree-children",e=0,s=u.children.length;e<s;e++)l.appendChild(this.redraw_node(u.children[e],i,!0));t.appendChild(l)}if(y&&t.appendChild(y),!r){for(f||(f=this.element[0]),e=0,s=f.childNodes.length;e<s;e++)if(f.childNodes[e]&&f.childNodes[e].className&&f.childNodes[e].className.indexOf("jstree-children")!==-1){c=f.childNodes[e];break}c||(c=w.createElement("UL"),c.setAttribute("role","group"),c.className="jstree-children",f.appendChild(c));f=c;v<f.childNodes.length?f.insertBefore(t,f.childNodes[v]):f.appendChild(t);b&&t.childNodes[1].focus()}return u.state.opened&&!u.state.loaded&&(u.state.opened=!1,setTimeout(n.proxy(function(){this.open_node(u.id,!1,0)},this),0)),t},open_node:function(i,r,u){var e,o,f,s;if(n.isArray(i)){for(i=i.slice(),e=0,o=i.length;e<o;e++)this.open_node(i[e],r,u);return!0}if(i=this.get_node(i),!i||i.id==="#")return!1;if(u=u===t?this.settings.core.animation:u,!this.is_closed(i))return r&&r.call(this,i,!1),!1;if(this.is_loaded(i))f=this.get_node(i,!0),s=this,f.length&&(i.children.length&&!this._firstChild(f.children(".jstree-children")[0])&&(i.state.opened=!0,this.redraw_node(i,!0),f=this.get_node(i,!0)),u?(this.trigger("before_open",{node:i}),f.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(u,function(){this.style.display="";s.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),f[0].className=f[0].className.replace("jstree-closed","jstree-open"),f[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),f.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),u&&f.length||this.trigger("after_open",{node:i});else{if(this.is_loading(i))return setTimeout(n.proxy(function(){this.open_node(i,r,u)},this),500);this.load_node(i,function(n,t){return t?this.open_node(n,r,u):r?r.call(this,n,!1):!1})}},_open_to:function(t){if(t=this.get_node(t),!t||t.id==="#")return!1;for(var u=t.parents,i=0,r=u.length;i<r;i+=1)i!=="#"&&this.open_node(u[i],!1,0);return n("#"+t.id.replace(n.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var f,e,o,u;if(n.isArray(i)){for(i=i.slice(),f=0,e=i.length;f<e;f++)this.close_node(i[f],r);return!0}if((i=this.get_node(i),!i||i.id==="#")||this.is_closed(i))return!1;r=r===t?this.settings.core.animation:r;o=this;u=this.get_node(i,!0);u.length&&(r?u.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="";u.children(".jstree-children").remove();o.trigger("after_close",{node:i})}):(u[0].className=u[0].className.replace("jstree-open","jstree-closed"),u.attr("aria-expanded",!1).children(".jstree-children").remove()));i.state.opened=!1;this.trigger("close_node",{node:i});r&&u.length||this.trigger("after_close",{node:i})},toggle_node:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(n,t,i){if(n||(n="#"),n=this.get_node(n),!n)return!1;var r=n.id==="#"?this.get_container_ul():this.get_node(n,!0),u,f,e;if(!r.length){for(u=0,f=n.children_d.length;u<f;u++)this.is_closed(this._model.data[n.children_d[u]])&&(this._model.data[n.children_d[u]].state.opened=!0);return this.trigger("open_all",{node:n})}i=i||r;e=this;r=this.is_closed(n)?r.find(".jstree-closed").addBack():r.find(".jstree-closed");r.each(function(){e.open_node(this,function(n,r){r&&this.is_parent(n)&&this.open_all(n,t,i)},t||0)});i.find(".jstree-closed").length===0&&this.trigger("open_all",{node:this.get_node(i)})},close_all:function(t,i){if(t||(t="#"),t=this.get_node(t),!t)return!1;var r=t.id==="#"?this.get_container_ul():this.get_node(t,!0),e=this,u,f;if(!r.length){for(u=0,f=t.children_d.length;u<f;u++)this._model.data[t.children_d[u]].state.opened=!1;return this.trigger("close_all",{node:t})}r=this.is_open(t)?r.find(".jstree-open").addBack():r.find(".jstree-open");n(r.get().reverse()).each(function(){e.close_node(this,i||0)});this.trigger("close_all",{node:t})},is_disabled:function(n){return n=this.get_node(n),n&&n.state&&n.state.disabled},enable_node:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.enable_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id==="#")return!1;t.state.disabled=!1;this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled");this.trigger("enable_node",{node:t})},disable_node:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.disable_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id==="#")return!1;t.state.disabled=!0;this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled");this.trigger("disable_node",{node:t})},activate_node:function(n,i){if(this.is_disabled(n))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(n)&&this.get_parent(n)===this._data.core.last_clicked.parent))if(i.shiftKey)for(var e=this.get_node(n).id,o=this._data.core.last_clicked.id,u=this.get_node(this._data.core.last_clicked.parent).children,f=!1,r=0,s=u.length;r<s;r+=1)u[r]===e&&(f=!f),u[r]===o&&(f=!f),f||u[r]===e||u[r]===o?this.select_node(u[r],!1,!1,i):this.deselect_node(u[r],!1,i);else this.is_selected(n)?this.deselect_node(n,!1,i):this.select_node(n,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(n)?this.deselect_node(n,!1,i):(this.deselect_all(!0),this.select_node(n,!1,!1,i),this._data.core.last_clicked=this.get_node(n));this.trigger("activate_node",{node:this.get_node(n)})},hover_node:function(n){if(n=this.get_node(n,!0),!n||!n.length||n.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t);n.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(n)});setTimeout(function(){i.attr("aria-activedescendant",n[0].id);n.attr("aria-selected",!0)},0)},dehover_node:function(n){if(n=this.get_node(n,!0),!n||!n.length||!n.children(".jstree-hovered").length)return!1;n.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(n)})},select_node:function(t,i,r,u){var f,e,o;if(n.isArray(t)){for(t=t.slice(),e=0,o=t.length;e<o;e++)this.select_node(t[e],i,r,u);return!0}if(t=this.get_node(t),!t||t.id==="#")return!1;f=this.get_node(t,!0);t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(f=this._open_to(t)),f&&f.length&&f.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:u}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:u}))},deselect_node:function(t,i,r){var u,e,f;if(n.isArray(t)){for(t=t.slice(),u=0,e=t.length;u<e;u++)this.deselect_node(t[u],i,r);return!0}if(t=this.get_node(t),!t||t.id==="#")return!1;f=this.get_node(t,!0);t.state.selected&&(t.state.selected=!1,this._data.core.selected=n.vakata.array_remove_item(this._data.core.selected,t.id),f.length&&f.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))},select_all:function(n){var r=this._data.core.selected.concat([]),t,i;for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});n||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:r})},deselect_all:function(n){for(var i=this._data.core.selected.concat([]),t=0,r=this._data.core.selected.length;t<r;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked");this.trigger("deselect_all",{selected:this._data.core.selected,node:i});n||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(n){return(n=this.get_node(n),!n||n.id==="#")?!1:n.state.selected},get_selected:function(t){return t?n.map(this._data.core.selected,n.proxy(function(n){return this.get_node(n)},this)):this._data.core.selected},get_top_selected:function(t){for(var r=this.get_selected(!0),u={},f,o,i=0,e=r.length;i<e;i++)u[r[i].id]=r[i];for(i=0,e=r.length;i<e;i++)for(f=0,o=r[i].children_d.length;f<o;f++)u[r[i].children_d[f]]&&delete u[r[i].children_d[f]];r=[];for(i in u)u.hasOwnProperty(i)&&r.push(i);return t?n.map(r,n.proxy(function(n){return this.get_node(n)},this)):r},get_bottom_selected:function(t){for(var r=this.get_selected(!0),u=[],i=0,f=r.length;i<f;i++)r[i].children.length||u.push(r[i].id);return t?n.map(u,n.proxy(function(n){return this.get_node(n)},this)):u},get_state:function(){var t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(var n in this._model.data)this._model.data.hasOwnProperty(n)&&n!=="#"&&(this._model.data[n].state.opened&&t.core.open.push(n),this._model.data[n].state.selected&&t.core.selected.push(n));return t},set_state:function(i,r){if(i){if(i.core){var f,e,u,o;if(i.core.open)return n.isArray(i.core.open)?(f=!0,e=!1,u=this,n.each(i.core.open.concat([]),function(t,o){e=u.get_node(o);e&&(u.is_loaded(o)?(u.is_closed(o)&&u.open_node(o,!1,0),i&&i.core&&i.core.open&&n.vakata.array_remove_item(i.core.open,o)):(u.is_loading(o)||u.open_node(o,n.proxy(function(t,u){!u&&i&&i.core&&i.core.open&&n.vakata.array_remove_item(i.core.open,t.id);this.set_state(i,r)},u),0),f=!1))}),f&&(delete i.core.open,this.set_state(i,r)),!1):(delete i.core.open,this.set_state(i,r),!1);if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;
/*!
					if(state.core.themes) {
						if(state.core.themes.name) {
							this.set_theme(state.core.themes.name);
						}
						if(typeof state.core.themes.dots !== 'undefined') {
							this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
						}
						if(typeof state.core.themes.icons !== 'undefined') {
							this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
						}
						delete state.core.themes;
						delete state.core.open;
						this.set_state(state, callback);
						return false;
					}
					*/
if(i.core.selected)return o=this,this.deselect_all(),n.each(i.core.selected,function(n,t){o.select_node(t)}),delete i.core.selected,this.set_state(i,r),!1;if(n.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return n.isEmptyObject(i)?(i=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(t){this._data.core.state=this.get_state();this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var i=this.get_container_ul()[0].className;t||this.element.html("<ul class='"+i+"'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'><\/i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'><\/i>"+this.get_string("Loading ...")+"<\/a><\/li><\/ul>");this.load_node("#",function(t,r){r&&(this.get_container_ul()[0].className=i,this.set_state(n.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id==="#")return!1;var i=[],r=this._data.core.selected.concat([]);t.state.opened===!0&&i.push(t.id);this.get_node(t,!0).find(".jstree-open").each(function(){i.push(this.id)});this._load_nodes(i,n.proxy(function(n){this.open_node(n,!1,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:t,nodes:n})},this))},set_id:function(t,i){if(t=this.get_node(t),!t||t.id==="#")return!1;var r,f,u=this._model.data;for(i=i.toString(),u[t.parent].children[n.inArray(t.id,u[t.parent].children)]=i,r=0,f=t.parents.length;r<f;r++)u[t.parents[r]].children_d[n.inArray(t.id,u[t.parents[r]].children_d)]=i;for(r=0,f=t.children.length;r<f;r++)u[t.children[r]].parent=i;for(r=0,f=t.children_d.length;r<f;r++)u[t.children_d[r]].parents[n.inArray(t.id,u[t.children_d[r]].parents)]=i;return r=n.inArray(t.id,this._data.core.selected),r!==-1&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&r.attr("id",i),delete u[t.id],t.id=i,u[i]=t,!0},get_text:function(n){return n=this.get_node(n),!n||n.id==="#"?!1:n.text},set_text:function(t,i){var u,f,r,e;if(n.isArray(t)){for(t=t.slice(),u=0,f=t.length;u<f;u++)this.set_text(t[u],i);return!0}return(t=this.get_node(t),!t||t.id==="#")?!1:(t.text=i,r=this.get_node(t,!0),r.length&&(r=r.children(".jstree-anchor:eq(0)"),e=r.children("I").clone(),r.html(i).prepend(e),this.trigger("set_text",{obj:t,text:i})),!0)},get_json:function(n,t,i){if(n=this.get_node(n||"#"),!n)return!1;t&&t.flat&&!i&&(i=[]);var r={id:n.id,text:n.text,icon:this.get_icon(n),li_attr:n.li_attr,a_attr:n.a_attr,state:{},data:t&&t.no_data?!1:n.data},u,f;if(t&&t.flat?r.parent=n.parent:r.children=[],!t||!t.no_state)for(u in n.state)n.state.hasOwnProperty(u)&&(r.state[u]=n.state[u]);if(t&&t.no_id&&(delete r.id,r.li_attr&&r.li_attr.id&&delete r.li_attr.id),t&&t.flat&&n.id!=="#"&&i.push(r),!t||!t.no_children)for(u=0,f=n.children.length;u<f;u++)t&&t.flat?this.get_json(n.children[u],t,i):r.children.push(this.get_json(n.children[u],t));return t&&t.flat?i:n.id==="#"?r.children:r},create_node:function(i,r,u,f,e){if(i===null&&(i="#"),i=this.get_node(i),!i)return!1;if(u=u===t?"last":u,!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,u,f,!0)});r||(r={text:this.get_string("New node")});r.text===t&&(r.text=this.get_string("New node"));var o,h,s,c;i.id==="#"&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":o=this.get_node(i.parent);u=n.inArray(i.id,o.children);i=o;break;case"after":o=this.get_node(i.parent);u=n.inArray(i.id,o.children)+1;i=o;break;case"inside":case"first":u=0;break;case"last":u=i.children.length;break;default:u||(u=0)}if(u>i.children.length&&(u=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,u))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.id===!0&&delete r.id,r=this._parse_model_from_json(r,i.id,i.parents.concat()),!r)return!1;for(o=this.get_node(r),h=[],h.push(r),h=h.concat(o.children_d),this.trigger("model",{nodes:h,parent:i.id}),i.children_d=i.children_d.concat(h),s=0,c=i.parents.length;s<c;s++)this._model.data[i.parents[s]].children_d=this._model.data[i.parents[s]].children_d.concat(h);for(r=o,o=[],s=0,c=i.children.length;s<c;s++)o[s>=u?s+1:s]=i.children[s];return o[u]=r.id,i.children=o,this.redraw_node(i,!0),f&&f.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:u}),r.id},rename_node:function(t,i){var r,u,f;if(n.isArray(t)){for(t=t.slice(),r=0,u=t.length;r<u;r++)this.rename_node(t[r],i);return!0}return(t=this.get_node(t),!t||t.id==="#")?!1:(f=t.text,!this.check("rename_node",t,this.get_parent(t),i))?(this.settings.core.error.call(this,this._data.core.last_error),!1):(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:f}),!0)},delete_node:function(t){var o,c,u,i,f,e,l,r,s,h;if(n.isArray(t)){for(t=t.slice(),o=0,c=t.length;o<c;o++)this.delete_node(t[o]);return!0}if(t=this.get_node(t),!t||t.id==="#")return!1;if(u=this.get_node(t.parent),i=n.inArray(t.id,u.children),h=!1,!this.check("delete_node",t,u,i))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(i!==-1&&(u.children=n.vakata.array_remove(u.children,i)),f=t.children_d.concat([]),f.push(t.id),r=0,s=f.length;r<s;r++){for(e=0,l=t.parents.length;e<l;e++)i=n.inArray(f[r],this._model.data[t.parents[e]].children_d),i!==-1&&(this._model.data[t.parents[e]].children_d=n.vakata.array_remove(this._model.data[t.parents[e]].children_d,i));this._model.data[f[r]].state.selected&&(h=!0,i=n.inArray(f[r],this._data.core.selected),i!==-1&&(this._data.core.selected=n.vakata.array_remove(this._data.core.selected,i)))}for(this.trigger("delete_node",{node:t,parent:u.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:u.id}),r=0,s=f.length;r<s;r++)delete this._model.data[f[r]];return this.redraw_node(u,!0),!0},check:function(t,i,r,u,f){i=i&&i.id?i:this.get_node(i);r=r&&r.id?r:this.get_node(r);var e=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return(t==="move_node"||t==="copy_node")&&(!f||!f.is_multi)&&(i.id===r.id||n.inArray(i.id,r.children)===u||n.inArray(r.id,i.children_d)!==-1)?(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):(e&&e.data&&(e=e.data),e&&e.functions&&(e.functions[t]===!1||e.functions[t]===!0))?(e.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})}),e.functions[t]):o===!1||n.isFunction(o)&&o.call(this,t,i,r,u,f)===!1||o&&o[t]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(i,r,u,f,e){var w,b,a,k,s,h,d,l,c,o,v,p,g,y;if(r=this.get_node(r),u=u===t?0:u,!r)return!1;if(!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,u,f,!0)});if(n.isArray(i)){for(i=i.reverse().slice(),w=0,b=i.length;w<b;w++)this.move_node(i[w],r,u,f,e);return!0}if(i=i&&i.id?i:this.get_node(i),!i||i.id==="#")return!1;if(a=(i.parent||"#").toString(),s=!u.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent),h=i.instance?i.instance:this._model.data[i.id]?this:n.jstree.reference(i.id),d=!h||!h._id||this._id!==h._id,k=h&&h._id&&a&&h._model.data[a]&&h._model.data[a].children?n.inArray(i.id,h._model.data[a].children):-1,d)return this.copy_node(i,r,u,f,e)?(h&&h.delete_node(i),!0):!1;s.id==="#"&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":u=n.inArray(r.id,s.children);break;case"after":u=n.inArray(r.id,s.children)+1;break;case"inside":case"first":u=0;break;case"last":u=s.children.length;break;default:u||(u=0)}if(u>s.children.length&&(u=s.children.length),!this.check("move_node",i,s,u,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===s.id){for(l=s.children.concat(),c=n.inArray(i.id,l),c!==-1&&(l=n.vakata.array_remove(l,c),u>c&&u--),c=[],o=0,v=l.length;o<v;o++)c[o>=u?o+1:o]=l[o];c[u]=i.id;s.children=c;this._node_changed(s.id);this.redraw(s.id==="#")}else{for(c=i.children_d.concat(),c.push(i.id),o=0,v=i.parents.length;o<v;o++){for(l=[],y=h._model.data[i.parents[o]].children_d,p=0,g=y.length;p<g;p++)n.inArray(y[p],c)===-1&&l.push(y[p]);h._model.data[i.parents[o]].children_d=l}for(h._model.data[a].children=n.vakata.array_remove_item(h._model.data[a].children,i.id),o=0,v=s.parents.length;o<v;o++)this._model.data[s.parents[o]].children_d=this._model.data[s.parents[o]].children_d.concat(c);for(l=[],o=0,v=s.children.length;o<v;o++)l[o>=u?o+1:o]=s.children[o];for(l[u]=i.id,s.children=l,s.children_d.push(i.id),s.children_d=s.children_d.concat(i.children_d),i.parent=s.id,c=s.parents.concat(),c.unshift(s.id),y=i.parents.length,i.parents=c,c=c.concat(),o=0,v=i.children_d.length;o<v;o++)this._model.data[i.children_d[o]].parents=this._model.data[i.children_d[o]].parents.slice(0,y*-1),Array.prototype.push.apply(this._model.data[i.children_d[o]].parents,c);this._node_changed(a);this._node_changed(s.id);this.redraw(a==="#"||s.id==="#")}return f&&f.call(this,i,s,u),this.trigger("move_node",{node:i,parent:s.id,position:u,old_parent:a,old_position:k,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),!0},copy_node:function(i,r,u,f,e){var y,w,c,l,h,p,a,v,o,s,b;if(r=this.get_node(r),u=u===t?0:u,!r)return!1;if(!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,u,f,!0)});if(n.isArray(i)){for(i=i.reverse().slice(),y=0,w=i.length;y<w;y++)this.copy_node(i[y],r,u,f,e);return!0}if(i=i&&i.id?i:this.get_node(i),!i||i.id==="#")return!1;v=(i.parent||"#").toString();o=!u.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent);s=i.instance?i.instance:this._model.data[i.id]?this:n.jstree.reference(i.id);b=!s||!s._id||this._id!==s._id;o.id==="#"&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":u=n.inArray(r.id,o.children);break;case"after":u=n.inArray(r.id,o.children)+1;break;case"inside":case"first":u=0;break;case"last":u=o.children.length;break;default:u||(u=0)}if(u>o.children.length&&(u=o.children.length),!this.check("copy_node",i,o,u,{core:!0,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if((a=s?s.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i,!a)||(a.id===!0&&delete a.id,a=this._parse_model_from_json(a,o.id,o.parents.concat()),!a))return!1;for(l=this.get_node(a),i&&i.state&&i.state.loaded===!1&&(l.state.loaded=!1),c=[],c.push(a),c=c.concat(l.children_d),this.trigger("model",{nodes:c,parent:o.id}),h=0,p=o.parents.length;h<p;h++)this._model.data[o.parents[h]].children_d=this._model.data[o.parents[h]].children_d.concat(c);for(c=[],h=0,p=o.children.length;h<p;h++)c[h>=u?h+1:h]=o.children[h];return c[u]=l.id,o.children=c,o.children_d.push(l.id),o.children_d=o.children_d.concat(l.children_d),this._node_changed(o.id),this.redraw(o.id==="#"),f&&f.call(this,l,o,u),this.trigger("copy_node",{node:l,original:i,parent:o.id,position:u,old_parent:v,old_position:s&&s._id&&v&&s._model.data[v]&&s._model.data[v].children?n.inArray(i.id,s._model.data[v].children):-1,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id,old_instance:s,new_instance:this}),l.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),n.isArray(t)||(t=[t]),!t.length)return!1;for(var o=[],r,e=0,s=t.length;e<s;e++)r=this.get_node(t[e]),r&&r.id&&r.id!=="#"&&o.push(r);if(!o.length)return!1;u=o;f=this;i="move_node";this.trigger("cut",{node:t})},copy:function(t){if(t||(t=this._data.core.selected.concat()),n.isArray(t)||(t=[t]),!t.length)return!1;for(var o=[],r,e=0,s=t.length;e<s;e++)r=this.get_node(t[e]),r&&r.id&&r.id!=="#"&&o.push(r);if(!o.length)return!1;u=o;f=this;i="copy_node";this.trigger("copy",{node:t})},get_buffer:function(){return{mode:i,node:u,inst:f}},can_paste:function(){return i!==!1&&u!==!1},paste:function(n,t){if(n=this.get_node(n),!n||!i||!i.match(/^(copy_node|move_node)$/)||!u)return!1;this[i](u,n,t)&&this.trigger("paste",{parent:n.id,node:u,mode:i});u=!1;i=!1;f=!1},edit:function(t,i){if(t=this._open_to(t),!t||!t.length)return!1;if(this.settings.core.check_callback===!1)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;var c=this._data.core.rtl,s=this.element.width(),r=t.children(".jstree-anchor"),u=n("<span>"),f=typeof i=="string"?i:this.get_text(t),e=n("<div />",{css:{position:"absolute",top:"-200px",left:c?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),o=n("<input />",{value:f,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:n.proxy(function(){var i=u.children(".jstree-rename-input"),n=i.val();n===""&&(n=f);e.remove();u.replaceWith(r);u.remove();this.set_text(t,f);this.rename_node(t,n)===!1&&this.set_text(t,f)},this),keydown:function(n){var t=n.which;t===27&&(this.value=f);(t===27||t===13||t===37||t===38||t===39||t===40||t===32)&&n.stopImmediatePropagation();(t===27||t===13)&&(n.preventDefault(),this.blur())},click:function(n){n.stopImmediatePropagation()},mousedown:function(n){n.stopImmediatePropagation()},keyup:function(){o.width(Math.min(e.text("pW"+this.value).width(),s))},keypress:function(n){if(n.which===13)return!1}}),h={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};this.set_text(t,"");u.attr("class",r.attr("class")).append(r.contents().clone()).append(o);r.replaceWith(u);e.css(h);o.css(h).width(Math.min(e.text("pW"+o[0].value).width(),s))[0].select()},set_theme:function(t,i){if(!t)return!1;if(i===!0){var r=this.settings.core.themes.dir;r||(r=n.jstree.path+"/themes");i=r+"/"+t+"/style.css"}i&&n.inArray(i,c)===-1&&(n("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),c.push(i));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=t;this.element.addClass("jstree-"+t);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive");this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(n){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);this._data.core.themes.variant=n;n&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(t,i){var u,e,r,f;if(n.isArray(t)){for(t=t.slice(),u=0,e=t.length;u<e;u++)this.set_icon(t[u],i);return!0}return(t=this.get_node(t),!t||t.id==="#")?!1:(f=t.icon,t.icon=i,r=this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon"),i===!1?this.hide_icon(t):i===!0?r.removeClass("jstree-themeicon-custom "+f).css("background","").removeAttr("rel"):i.indexOf("/")===-1&&i.indexOf(".")===-1?(r.removeClass(f).css("background",""),r.addClass(i+" jstree-themeicon-custom").attr("rel",i)):(r.removeClass(f).css("background",""),r.addClass("jstree-themeicon-custom").css("background","url('"+i+"') center center no-repeat").attr("rel",i)),!0)},get_icon:function(n){return n=this.get_node(n),!n||n.id==="#"?!1:n.icon},hide_icon:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.hide_icon(t[i]);return!0}return(t=this.get_node(t),!t||t==="#")?!1:(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,u,r;if(n.isArray(t)){for(t=t.slice(),i=0,u=t.length;i<u;i++)this.show_icon(t[i]);return!0}return(t=this.get_node(t),!t||t==="#")?!1:(r=this.get_node(t,!0),t.icon=r.length?r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,t.icon||(t.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}};n.vakata={};n.vakata.attributes=function(t,i){t=n(t)[0];var r=i?{}:[];return t&&t.attributes&&n.each(t.attributes,function(t,u){n.inArray(u.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])===-1&&u.nodeValue!==null&&n.trim(u.nodeValue)!==""&&(i?r[u.nodeName]=u.nodeValue:r.push(u.nodeName))}),r};n.vakata.array_unique=function(n){for(var r=[],i,t=0,u=n.length;t<u;t++){for(i=0;i<=t;i++)if(n[t]===n[i])break;i===t&&r.push(n[t])}return r};n.vakata.array_remove=function(n,t,i){var r=n.slice((i||t)+1||n.length);return n.length=t<0?n.length+t:t,n.push.apply(n,r),n};n.vakata.array_remove_item=function(t,i){var r=n.inArray(i,t);return r!==-1?n.vakata.array_remove(t,r):t}}});