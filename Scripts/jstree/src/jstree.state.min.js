(function(n){"use strict";typeof define=="function"&&define.amd?define("jstree.state",["jquery","jstree"],n):typeof exports=="object"?n(require("jquery"),require("jstree")):n(jQuery,jQuery.jstree)})(function(n){"use strict";if(!n.jstree.plugins.state){var t=!1;n.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1};n.jstree.plugins.state=function(i,r){this.bind=function(){r.bind.call(this);var i=n.proxy(function(){this.element.on(this.settings.state.events,n.proxy(function(){t&&clearTimeout(t);t=setTimeout(n.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",n.proxy(function(){this.element.one("restore_state.jstree",i);this.restore_state()||i()},this))};this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};n.vakata.storage.set(this.settings.state.key,JSON.stringify(t))};this.restore_state=function(){var t=n.vakata.storage.get(this.settings.state.key);if(!!t)try{t=JSON.parse(t)}catch(i){return!1}if(!!t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)return!1;if(!!t&&t.state&&(t=t.state),!!t&&n.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t){this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:n.extend(!0,{},t)})});return this.set_state(t),!0}return!1};this.clear_state=function(){return n.vakata.storage.del(this.settings.state.key)}},function(n){n.vakata.storage={set:function(n,t){return window.localStorage.setItem(n,t)},get:function(n){return window.localStorage.getItem(n)},del:function(n){return window.localStorage.removeItem(n)}}}(jQuery)}});