$(document).ready(function(){$(".dataTable").each(function(){var n=[],t=[];$("thead th",this).each(function(i){var f=$(this).data("template"),e=$(this).data("order"),r=$(this).data("option"),o=$(this).data("key"),s=$(this).data("search-operator"),h=$(this).data("data-type"),c=$(this).data("format"),u;e&&t.push([i,e]);u=!0;o||(u=!1);n.push({data:o,render:function(n,t,i,u){var e,v,o,l,a;if(u.settings.columnSettings=u.settings.columnSettings||{},u.settings.columnSettings[u.col]=u.settings.columnSettings[u.col]||{},e=u.settings.columnSettings[u.col],e.searchOpeartor=s,e.dataType=h,e.format=c,r&&n!=null)for(v=n.toString(),e.option=r,o=0;o<r.length;o++)if(r[o].value==v){n=r[o].name;break}if(!f)return n;for(a in i)l=(l||f).replaceAll("{"+a+"}",i[a]);return l},orderable:u})});$(this).DataTable({processing:!0,serverSide:!0,filter:!1,ajax:{url:$(this).data("source"),data:function(n,t){for(var i=0;i<n.columns.length;i++)$("tr.search>th:eq("+i+")",$("#"+t.sTableId)).find(".form-control").each(function(){n.columns[i].search[$(this).attr("name")]=$(this).val();n.columns[i].search.opeartor=$(this).data("opeartor")});return n},type:"POST"},columns:n,order:t,language:{lengthMenu:"每页 _MENU_ 条记录",zeroRecords:"没有找到记录",info:"第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",infoEmpty:"无记录",infoFiltered:"(从 _MAX_ 条记录过滤)",paginate:{previous:"上一页",next:"下一页"},search:"关键字:"},initComplete:function(){this.api().columns().every(function(){var u=this,t=u.settings()[0].columnSettings[u[0][0]],i,n,r;if(t.searchOpeartor!="None"){if(i=t.option,n=null,i)for(n=$('<select class="form-control" name="value"><\/select>'),n.data("opeartor",t.searchOpeartor).data("data-type",t.dataType),n.append('<option value="">-- 请选择 --<\/option>'),r=0;r<i.length;r++)n.append('<option value="'+i[r].value+'">'+i[r].name+"<\/option>");else t.searchOpeartor=="Range"?(n=$('<div class="range-search"><div class="input-group"><input name="valueMin" class="form-control min" type="text" placeholder="大于"><div class="input-group-addon">-<\/div><\/div><input name="valueMax" class="form-control max" type="text" placeholder="小于"><\/div>'),$(".min",n).data("opeartor",t.searchOpeartor).data("data-type",t.dataType),$(".max",n).data("opeartor",t.searchOpeartor).data("data-type",t.dataType)):(n=$('<input class="form-control" type="text" name="value" placeholder="输入搜索..."/>'),n.data("opeartor",t.searchOpeartor),n.data("data-type",t.dataType));t.dataType=="DateTime"&&n.find(".form-control").datepicker({language:"zh-CN",format:"yyyy/mm/dd"});n.appendTo($(u.footer()))}else $('<a href="javascript:void(0)" class="reset-search glyphicon glyphicon-repeat"><\/a>').appendTo($(u.footer()))})}}).on("keyup change",function(n){if(n.type=="change"||n.type=="keyup"&&n.keyCode==13){var t=!0;$("tr.search>th .form-control",this).each(function(){if(t){var n=$(this).data("data-type");n=="DateTime"&&$(this).val()&&(Date.parse($(this).val())||(t=!1))}});t&&$(this).DataTable().draw()}}).on("click",".range-search .input-group-addon",function(){$(this).closest(".range-search").find("input.max").toggleClass("show")}).on("click",".reset-search",function(){$(".form-control",$(this).closest(".search")).each(function(){$(this).val("")}).first().trigger("change")})})});